import { Remarkable } from 'remarkable';
import RemarkableReactRenderer from 'remarkable-react';
import code from '../components/remarkable-components/code';
import pre from '../components/remarkable-components/pre';
import blockquote from '../components/remarkable-components/blockquote';
import table from '../components/remarkable-components/table';
import img from '../components/remarkable-components/img';
import { injectTokenRecognizer } from './linkExtension';

const CustomComponent = (props: any) => {
    // console.log(props);
    return <>VIDEO</>;
};

const CustomComponent2 = (props: any) => {
    // console.log(props);
    return <>ATTACHMENT</>;
};

const CustomComponent3 = (props: any) => {
    console.log('CLOSE');
    return null;
};

const md = new Remarkable();
md.inline.ruler.enable(['sub', 'sup']);

md.renderer = new RemarkableReactRenderer({
    components: {
        blockquote: blockquote,
        code: code,
        pre: pre,
        table: table,
        img: img,
        video: CustomComponent,
        attachment: CustomComponent2,
        link_close2: CustomComponent3
    },
    tokens: {
        link_video_open: 'video',
        link_attachment_open: 'attachment',
        link_close: 'link_close2'
    }
});

const rules = md.inline.ruler.getRules('');
const origParser = rules.find((rule) => rule.name === 'links');
if (origParser) {
    injectTokenRecognizer(md, origParser);
}

const render = (text: string | undefined) => {
    return md.render(text || 'Brak zawarto≈õci');
};

export const markdown = {
    render
};
