import React from 'react';
import { taskService } from '../../../services/taskService';
import { TaskCardData } from '../../../models/task';
import useAxiosEffect from '../../generic/useAxiosEffect';
import { useAppSelector } from '../../../context/hooks';
import { currentUserData } from '../../../context/userReducer';
import { groupTasks } from './groupTasks';
import TaskCategoryComponent from './taskCategoryComponent';
import { ComponentStateHandler } from '../../generic/componentStateHandler';

const TaskListComponent = () => {
    const user = useAppSelector(currentUserData);
    const state = useAxiosEffect<TaskCardData[]>(taskService.getAll, [user.solved]);
    const tasks = state.data;

    const categoryTasks = groupTasks(tasks);

    return (
        <ComponentStateHandler state={state}>
            {categoryTasks.map((tc) => {
                return tc.tasks.length > 0 && <TaskCategoryComponent key={tc.id} category={tc} />;
            })}
        </ComponentStateHandler>
    );
};

export default TaskListComponent;
