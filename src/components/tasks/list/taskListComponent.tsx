import React from 'react';
import { taskService } from '../../../services/taskService';
import { TaskCardData } from '../../../models/task';
import useAxiosEffect from '../../generic/useAxiosEffect';
import ComponentStateHandler from '../../generic/componentStateHandler';
import { useAppSelector } from '../../../context/hooks';
import { currentUserData } from '../../../context/userReducer';
import { splitTaskList } from './splitTaskList';
import TaskCategoryComponent from './taskCategoryComponent';
import CardsContainer from '../../styled-components/common/CardsContainer';

const TaskListComponent = () => {
    const user = useAppSelector(currentUserData);
    const state = useAxiosEffect<TaskCardData[]>(taskService.getAll, [user.solved]);
    const tasks = state.data;

    const categoryTasks = splitTaskList(tasks);

    return (
        <ComponentStateHandler state={state}>
            <CardsContainer>
                {categoryTasks &&
                    categoryTasks.map((tc) => {
                        return tc.tasks.length > 0 && <TaskCategoryComponent key={tc.id} category={tc} />;
                    })}
            </CardsContainer>
        </ComponentStateHandler>
    );
};

export default TaskListComponent;
