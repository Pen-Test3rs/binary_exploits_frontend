import React, { useEffect, useState } from 'react';
import TaskCard from './taskCard';
import Pagination from '../pagination/pagination';
import { Levels } from './levels';
import { tasksService } from '../../services/tasksService';
import { apiUrls } from '../../utils/apiUrls';
import { TasksList } from '../../models/task';

const TasksComponent = () => {
    const [tasks, setTasks] = useState<TasksList[]>([]);
    const pageLimit = 5;
    const dataLimit = 12;
    useEffect(() => {
        (async () => {
            tasksService
                .get(apiUrls.TASKS)
                .then((a) => {
                    setTasks(a);
                })
                .catch((err) => {
                    //TODO: handle error
                });
        })();
    }, []);

    for (let i = 3; i < 32; i++)
        tasks.push({
            id: i,
            name_id: 'buffer_overflow',
            labels: ['tag1', 'tag2', 'tag3'],
            title: 'PrzepeÅ‚nienie bufora',
            level: Levels.Hard,
            points: 100,
            status: 'ok'
        });

    function wrapTasks() {
        return tasks.map((task) => <TaskCard key={task.id} taskData={task} />);
    }

    return (
        <>
            <div className="flex flex-wrap w-full">
                <Pagination
                    data={wrapTasks()}
                    pageLimit={Math.min(Math.ceil(tasks.length / dataLimit), pageLimit)}
                    dataLimit={dataLimit}
                />
            </div>
        </>
    );
};

export default TasksComponent;
