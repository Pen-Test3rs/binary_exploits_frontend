import RatingCard from './ratingCard';
import CardLineChart from '../charts/cardLineChart';
import useAxiosEffect from '../generic/useAxiosEffect';
import { dashboardService } from '../../services/dashboardService';
import { prepareChartData } from '../charts/prepareChartData';
import { ComponentStateHandler, getAggregatedState } from '../generic/componentStateHandler';
import LiveActivityComponent from './liveActivityComponent';
import { FaTrophy } from 'react-icons/fa';
import { LiveActivity, Rating } from '../../models/dashboard';

const DashboardComponent = () => {
    const dashboardState = useAxiosEffect<[Rating[], LiveActivity[]]>(
        getAggregatedState(dashboardService.getRating, dashboardService.getLiveActivity),
        []
    );

    const ratingData = prepareChartData(dashboardState?.data?.[0] || []);
    const liveActivityData = dashboardState?.data?.[1] || [];

    return (
        <ComponentStateHandler state={dashboardState}>
            <div className="flex flex-col items-center lg:pt-0 w-full mx-auto px-4">
                <div className={'bg-white rounded-lg flex flex-col items-stretch shadow my-2 w-99 lg:w-200'}>
                    <div
                        className={
                            'bg-indigo-700 rounded-t-lg self-stretch text-lg border-t p-2 text-white flex flex-wrap items-center gap-1'
                        }
                    >
                        <div className="mx-2">
                            <FaTrophy />
                        </div>
                        <div>Scoreboard</div>
                    </div>
                    <div className="w-full">
                        <CardLineChart ratingData={ratingData} displayLegend={true} className="h-96 rounded-b-lg" />
                    </div>
                </div>
                <div className="flex flex-col lg:flex-row lg:gap-4">
                    <div className={'bg-white rounded-lg flex flex-col items-stretch shadow my-2 w-99'}>
                        <div
                            className={
                                'bg-indigo-700 rounded-t-lg self-stretch text-lg border-t p-2 text-white flex flex-row items-center gap-1'
                            }
                        >
                            <div className="mx-2">
                                <FaTrophy />
                            </div>
                            <div>Lista rankingowa</div>
                        </div>
                        <div className="flex flex-col max-w-none lg:max-w-md w-full rounded-b-lg overflow-hidden">
                            <RatingCard ratingData={ratingData} />
                        </div>
                    </div>
                    <div className="my-2 w-99">
                        <LiveActivityComponent liveActivity={liveActivityData} />
                    </div>
                </div>
            </div>
        </ComponentStateHandler>
    );
};

export default DashboardComponent;
