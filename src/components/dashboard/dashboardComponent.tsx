import RatingCard from './ratingCard';
import CardLineChart from '../charts/cardLineChart';
import useAxiosEffect from '../generic/useAxiosEffect';
import { dashboardService } from '../../services/dashboardService';
import { prepareChartData } from '../charts/prepareChartData';
import { ComponentStateHandler, getAggregatedState } from '../generic/componentStateHandler';
import LiveActivityComponent from './liveActivityComponent';
import { FaTrophy } from 'react-icons/fa';
import { LiveActivity, Rating } from '../../models/dashboard';

const DashboardComponent = () => {
    const dashboardState = useAxiosEffect<[Rating[], LiveActivity[]]>(
        getAggregatedState(dashboardService.getRating, dashboardService.getLiveActivity),
        []
    );

    const ratingData = prepareChartData(dashboardState?.data?.[0] || []);
    const liveActivityData = dashboardState?.data?.[1] || [];

    return (
        <ComponentStateHandler state={dashboardState}>
            <div className="flex-col flex lg:flex-row justify-center p-4 lg:pt-0 w-full">
                <div className={'bg-white rounded-lg flex flex-col items-stretch shadow m-2'}>
                    <div
                        className={
                            'bg-indigo-700 rounded-t-lg self-stretch text-lg border-t p-2 text-white flex flex-row items-center gap-1'
                        }
                    >
                        <div className="mx-2">
                            <FaTrophy />
                        </div>
                        <div>Lista rankingowa</div>
                    </div>
                    <div className="flex flex-col max-w-none lg:max-w-md w-full">
                        <div className="mx-4 mt-4 mb-2">
                            <RatingCard ratingData={ratingData} />
                        </div>
                        <div className="mx-4 mt-2 mb-4">
                            <CardLineChart ratingData={ratingData} title={''} displayLegend={true} height={'h-96'} />
                        </div>
                    </div>
                </div>
                <div className="m-2">
                    <LiveActivityComponent liveActivity={liveActivityData} />
                </div>
            </div>
        </ComponentStateHandler>
    );
};

export default DashboardComponent;
