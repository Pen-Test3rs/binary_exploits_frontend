import { LiveActivity } from '../../models/dashboard';
import { Link } from 'react-router-dom';

import TimeAgo from 'javascript-time-ago';
import ReactTimeAgo from 'react-time-ago';
import pl from 'javascript-time-ago/locale/pl.json';
import { FaBolt, FaCheck } from 'react-icons/fa';
import CustomHeader from '../generic/CustomHeader';
import React from 'react';

TimeAgo.addDefaultLocale(pl);

type LiveActivityRowData = {
    username: string;
    title: string;
    date: Date;
    userID: number;
};

const LiveActivityRow = ({ username, title, date, userID }: LiveActivityRowData) => {
    return (
        <div className="border-t text-sm px-3 flex flex-row items-center py-2 gap-2">
            <div className="mx-2">
                <FaCheck />
            </div>
            <div className="flex-col">
                <div>
                    Użytkownik
                    <Link to={`/profile/${userID}`}>
                        <span className="font-semibold"> {username}</span>
                    </Link>{' '}
                    rozwiązał zadanie
                    <Link to="/tasks">
                        <span className="font-semibold"> {title}</span>
                    </Link>
                </div>
                <div className="text-xs font-semibold">
                    <ReactTimeAgo date={date} locale="pl-PL" />
                </div>
            </div>
        </div>
    );
};

interface LiveActivityProps {
    liveActivity: LiveActivity[];
}

const LiveActivityComponent = ({ liveActivity }: LiveActivityProps) => {
    const mappedLiveActivity = liveActivity.map((activity) => ({
        username: activity.user.username,
        userID: activity.user.id as number,
        title: activity.task.title,
        date: activity.date
    }));

    return (
        <div className={'bg-white rounded-lg flex flex-col items-stretch shadow'}>
            <CustomHeader title={'Aktywność użytkowników'} Icon={FaBolt} />
            {mappedLiveActivity.map((row, i) => (
                <LiveActivityRow key={i} {...row} />
            ))}
        </div>
    );
};

export default LiveActivityComponent;
