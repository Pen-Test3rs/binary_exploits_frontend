import { LiveActivity, Rating } from '../../models/dashboard';
import { useTable } from 'react-table';
import { useAppSelector } from '../../context/hooks';
import { currentUserData } from '../../context/userReducer';
import { Link } from 'react-router-dom';

import TimeAgo from 'javascript-time-ago';
import ReactTimeAgo from 'react-time-ago';
import pl from 'javascript-time-ago/locale/pl.json';

import { useMemo } from 'react';
import { FaBolt, FaCheck } from 'react-icons/fa';

TimeAgo.addDefaultLocale(pl);

interface LiveActivityProps {
    liveActivity: any[];
}
type LiveActivityRowData = { username: string; title: string; date: Date; userID: number };

const LiveActivityRow = ({ username, title, date, userID }: LiveActivityRowData) => {
    return (
        <div className="border-t text-sm px-3 flex flex-row items-center py-2 gap-2">
            <div className="mx-2">
                <FaCheck />
            </div>
            <div className="flex-col">
                <div>
                    Użytkownik
                    <Link to={`/profile/${userID}`}>
                        <span className="font-semibold"> {username}</span>
                    </Link>{' '}
                    rozwiązał zadanie
                    <Link to="/tasks">
                        <span className="font-semibold"> {title}.</span>
                    </Link>
                </div>
                <div className="text-xs font-semibold">
                    <ReactTimeAgo date={date} locale="pl-PL" />
                </div>
            </div>
        </div>
    );
};

const LiveActivityComponent = ({ liveActivity }: LiveActivityProps) => {
    liveActivity = liveActivity.map((activity) => ({
        username: activity.user.username,
        userID: activity.user.id,
        title: activity.task.title,
        date: activity.date
    }));

    return (
        <div className={'bg-white rounded-lg flex flex-col items-stretch shadow'}>
            <div
                className={
                    'bg-indigo-700 rounded-t-lg self-stretch text-lg border-t p-2 text-white flex flex-row items-center gap-1'
                }
            >
                <div className="mx-2">
                    <FaBolt />
                </div>
                <div>Aktywność użytkowników</div>
            </div>
            {liveActivity.map((row) => (
                <LiveActivityRow {...row} />
            ))}
        </div>
    );
};

export default LiveActivityComponent;
