import { Rating } from '../../models/dashboard';

export const prepareChartData = (ratingData: Rating[]) => {
    ratingData.forEach((user) => {
        let sum = 0;
        user.last_solved = user.last_solved
            .sort((a, b) => a.date.getTime() - b.date.getTime())
            .map(({ date, points }) => ({
                date,
                points: (sum += points)
            }));
    });

    const lastSolved = ratingData.flatMap((user) => user.last_solved).map((solve) => solve.date.getTime());
    const minDate = Math.min(...lastSolved);
    const maxDate = new Date().getTime();
    ratingData.forEach((user) => {
        const lastSolved = user.last_solved;
        if (!lastSolved.length) {
            lastSolved.push({ date: new Date(minDate), points: user.points });
        }
        if (!lastSolved.some((item) => item.date.getTime() === minDate)) {
            lastSolved.unshift({ date: new Date(minDate), points: 0 });
        }
        if (!lastSolved.some((item) => item.date.getTime() === maxDate)) {
            lastSolved.push({
                date: new Date(maxDate),
                points: lastSolved[lastSolved.length - 1].points
            });
        }
    });

    return ratingData;
};
