import React from 'react';
import { RouteComponentProps } from 'react-router-dom';
import { UserData } from '../../models/user';
import { profileService } from '../../services/profileService';
import ProfileContents from './profileContents';
import useAxiosEffect from '../generic/useAxiosEffect';
import { ComponentStateHandler } from '../generic/componentStateHandler';
import { ProfileHeader } from './profileHeader';
import { useAppSelector } from '../../context/hooks';
import { currentUserData } from '../../context/userReducer';
import EmptyProfile from './emptyProfile';

type TParams = {
    id: string;
};

const UserProfileComponent = ({ match }: RouteComponentProps<TParams>) => {
    const id = match.params.id;
    const state = useAxiosEffect<UserData>((opt) => profileService.get(id, opt), [id]);
    const userData = state.data as UserData;

    const user = useAppSelector(currentUserData);
    const isOwnProfile = userData?.id === user.id;
    const isEmpty = userData?.solutions?.length === 0;

    return (
        <ComponentStateHandler state={state}>
            <div className="bg-white shadow-xl rounded pb-6 max-w-fhd mx-auto w-full">
                <ProfileHeader username={userData?.username} viewingOwn={isOwnProfile} email={user.email} />
                {isEmpty ? (
                    <EmptyProfile viewingOwn={isOwnProfile} userData={userData} />
                ) : (
                    <ProfileContents userData={userData} />
                )}
            </div>
        </ComponentStateHandler>
    );
};

export default UserProfileComponent;
