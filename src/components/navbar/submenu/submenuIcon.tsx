import React from 'react';
import { useDetectClickOutside } from 'react-detect-click-outside';
import SubMenuNavbarLinksRenderer from './submenuNavbarLinksRenderer';
import { useAppDispatch, useAppSelector } from '../../../context/hooks';
import { closeMobileMenu, closeSubMenu, isSubMenuOpened, toggleSubMenu } from '../../../context/navbarReducer';

const SubmenuIcon = () => {
    const submenuVisible = useAppSelector(isSubMenuOpened);
    const dispatch = useAppDispatch();

    const hideSubMenu = () => {
        dispatch(closeSubMenu());
    };

    const toggle = () => {
        dispatch(toggleSubMenu());
        dispatch(closeMobileMenu());
    };

    const ref = useDetectClickOutside({
        onTriggered: hideSubMenu
    });

    return (
        <div
            className="absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0"
            ref={ref}
        >
            <div className="relative">
                <button
                    type="button"
                    className="flex text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white"
                    onClick={toggle}
                >
                    <img className="h-11 w-11 rounded-full" src={'/submenu-user-avatar.png'} alt="" />
                </button>

                {submenuVisible && <SubMenuNavbarLinksRenderer />}
            </div>
        </div>
    );
};

export default SubmenuIcon;
