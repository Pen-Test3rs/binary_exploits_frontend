import React from 'react';
import SubmenuNavbarLink from './submenuNavbarLink';
import { useAppDispatch, useAppSelector } from '../../../context/hooks';
import { isLoggedIn, logout, currentUserData } from '../../../context/userReducer';
import { useToasts } from 'react-toast-notifications';

interface SubMenuNavbarLinksRendererProps {
    hideSubMenu: () => void;
}

interface LinkProps {
    to: string;
    text: string;
    show?: boolean;
    additionalActions?: (() => void)[];
}

const logoutSuccessfulText = 'Wylogowano pomyślnie!';

const SubMenuNavbarLinksRenderer = ({ hideSubMenu }: SubMenuNavbarLinksRendererProps) => {
    const logged = useAppSelector(isLoggedIn);
    const user = useAppSelector(currentUserData);

    const dispatch = useAppDispatch();
    const { addToast } = useToasts();

    const logOut = () => {
        dispatch(logout());
        addToast(logoutSuccessfulText, {
            appearance: 'success'
        });
    };

    const submenuLinks: LinkProps[] = [
        {
            to: `/profile/${user.id}`,
            text: 'Mój profil'
        },
        {
            to: '/',
            text: 'Wyloguj',
            show: logged,
            additionalActions: [logOut]
        }
    ];

    return (
        <div className="z-10 origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-2xl py-1 bg-white">
            <div className="block px-4 py-2 text-sm text-gray-700 cursor-default">Zalogowany jako: {user.username}</div>
            {submenuLinks
                .filter(({ show = true }: LinkProps) => show)
                .map(({ to, text, additionalActions = [] }) => {
                    return (
                        <SubmenuNavbarLink
                            to={to}
                            text={text}
                            onClickActions={[hideSubMenu, ...additionalActions]}
                            key={text}
                        />
                    );
                })}
        </div>
    );
};

export default SubMenuNavbarLinksRenderer;
