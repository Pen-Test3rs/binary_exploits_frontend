import React from 'react';
import SubmenuNavbarLink from './submenuNavbarLink';
import { useAppDispatch, useAppSelector } from '../../../context/hooks';
import { isLoggedIn, logout } from '../../../context/userReducer';
import { useToasts } from 'react-toast-notifications';

interface SubMenuNavbarLinksRendererProps {
    hideSubMenu: () => void;
}

interface LinkProps {
    to: string;
    text: string;
    show?: boolean;
    additionalActions?: (() => void)[];
}

const logoutSuccessfulText = 'Logged out successfully!';

const SubMenuNavbarLinksRenderer = ({ hideSubMenu }: SubMenuNavbarLinksRendererProps) => {
    const logged = useAppSelector(isLoggedIn);
    const dispatch = useAppDispatch();
    const { addToast } = useToasts();

    const logOut = () => {
        dispatch(logout());
        addToast(logoutSuccessfulText, {
            appearance: 'success'
        });
    };

    const submenuLinks: LinkProps[] = [
        {
            to: '/profile',
            text: 'My profile'
        },
        {
            to: '/dashboard',
            text: 'Log out',
            show: logged,
            additionalActions: [logOut]
        },
        {
            to: '/login',
            text: 'Log in',
            show: !logged
        },
        {
            to: '/register',
            text: 'Register',
            show: !logged
        }
    ];

    return (
        <div className="z-10 origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-2xl py-1 bg-white">
            {submenuLinks
                .filter(({ show = true }: LinkProps) => show)
                .map(({ to, text, additionalActions = [] }) => {
                    return (
                        <SubmenuNavbarLink
                            to={to}
                            text={text}
                            onClickActions={[hideSubMenu, ...additionalActions]}
                            key={text}
                        />
                    );
                })}
        </div>
    );
};

export default SubMenuNavbarLinksRenderer;
