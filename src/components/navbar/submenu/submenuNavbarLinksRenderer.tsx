import React from 'react';
import SubmenuNavbarLink from './submenuNavbarLink';
import useOnclickOutside from 'react-cool-onclickoutside';
import { useAppSelector } from '../../../context/hooks';
import { isLoggedIn } from '../../../context/userReducer';

interface SubMenuNavbarLinksRendererProps {
    visible: boolean;
    hideSubMenu: () => void;
}

interface LinkProps {
    to: string;
    text: string;
    show?: boolean;
}

const SubMenuNavbarLinksRenderer = ({ visible, hideSubMenu }: SubMenuNavbarLinksRendererProps) => {
    const logged = useAppSelector(isLoggedIn);
    const ref = useOnclickOutside(
        () => {
            hideSubMenu();
        },
        {
            ignoreClass: 'my-ignore-class'
        }
    );

    const submenuLinks: LinkProps[] = [
        {
            to: '/profile',
            text: 'My profile',
            show: true
        },
        {
            to: '/logout',
            text: 'Log out',
            show: logged
        },
        {
            to: '/login',
            text: 'Log in',
            show: !logged
        },
        {
            to: '/register',
            text: 'Register',
            show: !logged
        }
    ];

    return (
        <div
            className="z-10 origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none"
            style={{
                display: visible ? '' : 'none'
            }}
            ref={ref}
        >
            {submenuLinks
                .filter(({ show }: LinkProps) => show)
                .map(({ to, text }) => {
                    return <SubmenuNavbarLink to={to} text={text} hideSubMenu={hideSubMenu} key={text} />;
                })}
        </div>
    );
};

export default SubMenuNavbarLinksRenderer;
