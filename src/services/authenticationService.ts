import { User } from '../models/user';
import axios from 'axios';
import { LoginData } from '../models/loginData';
import { RegisterData } from '../models/registerData';

const API_SERVER_URL = 'https://binexp.nitychoruk.pl'; //TODO - env

const getURL = (path: string) => {
    return API_SERVER_URL + path;
};

const loginUser = async (loginData: LoginData): Promise<User> => {
    return new Promise((resolve, reject) => {
        axios
            .post(getURL('/api/v1/auth/login/'), loginData)
            .then((res) => {
                const data = res.data; //TODO: adjust REST api
                const user: User = {
                    id: data.id,
                    username: data.username,
                    email: data.email,
                    accessToken: data.access,
                    refreshToken: data.refresh
                };
                resolve(user);
            })
            .catch((err) => {
                reject(err);
            });
    });
};

const registerUser = async (registerData: RegisterData): Promise<User> => {
    return new Promise((resolve, reject) => {
        const url = getURL('/api/v1/auth/register/');
        axios
            .post(url, registerData)
            .then((res) => {
                const data = res.data; //TODO: adjust REST api
                const user: User = {
                    id: data.id,
                    username: data.username,
                    email: data.email,
                    accessToken: data.access,
                    refreshToken: data.refreshToken
                };
                resolve(user);
            })
            .catch((err) => {
                reject(err);
            });
    });
};

export const authService = {
    loginUser,
    registerUser
};
