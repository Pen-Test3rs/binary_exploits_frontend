import { User } from '../models/user';
import { Role } from '../models/role';
import axios from 'axios';
import { LoginData } from '../models/loginData';
import { RegisterData } from '../models/registerData';

const API_SERVER_URL = '127.0.0.1/'; //TODO - env

const getURL = (path: string) => {
    return API_SERVER_URL + path;
};

const mockedUser: User = {
    id: 123,
    name: 'H4ck3r',
    email: 'h4ck3r@example.pl',
    role: Role.User,
    points: 1337
};

const mockLoginUser = async (loginData: LoginData) => {
    return new Promise((resolve, reject) => {
        setTimeout(() => resolve(mockedUser), 3000); //3s delay
        // setTimeout(() => reject('erorrs'), 1000); //3s delay
    });
};

const loginUser = async (loginData: LoginData) => {
    return mockLoginUser(loginData); //TODO: remove this after integration with backend

    return new Promise((resolve, reject) => {
        axios
            .post(getURL('/user/login'), loginData)
            .then((response) => {
                // const { message, token, username } = response;
                //set cookies, token etc etc and return filled User object
                resolve(response);
            })
            .catch((err) => {
                console.log(err);
                reject('ups');
            });
    });
};

const mockRegisterUser = async (registerData: RegisterData) => {
    return new Promise((resolve, reject) => {
        setTimeout(() => resolve(mockedUser), 3000); //3s delay
        // setTimeout(() => reject('erorrs'), 1000); //3s delay
    });
};

const registerUser = async (registerData: RegisterData) => {
    return mockRegisterUser(registerData); //TODO: remove this after integration with backend

    return new Promise((resolve, reject) => {
        axios
            .post(getURL('/user/register'), registerData)
            .then((response) => {
                // const { message, token, username } = response;
                //set cookies, token etc etc and return filled User object
                resolve(response);
            })
            .catch((err) => {
                console.log(err);
                reject('ups');
            });
    });
};

export const authService = {
    loginUser,
    registerUser
};
